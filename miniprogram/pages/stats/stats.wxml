<view class="container">
  <block wx:if="{{isLoading}}">
    <view class="card loading-card">
      <view class="loading-text">{{i18n.common_loading}}</view>
    </view>
  </block>

  <block wx:else>
    <!-- Filter Picker -->
    <view class="filter-section">
      <view class="filter-label">{{i18n.stats_view_for || 'View stats for'}}:</view>
      <picker
        mode="selector"
        range="{{filterOptions}}"
        range-key="label"
        bindchange="onFilterChange"
      >
        <view class="filter-picker">
          <text class="filter-value">{{selectedFilterLabel}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <!-- Season Stats -->
    <block wx:if="{{selectedFilter}}">
      <view class="card">
        <view class="title">{{selectedFilterLabel || i18n.stats_title}}</view>
        <block wx:if="{{seasonStats}}">
          <view class="stats-grid">
            <view class="stat-item">
              <view class="stat-value">{{seasonStats.matchesPlayed || 0}}</view>
              <view class="stat-label">{{i18n.stats_matches_played}}</view>
            </view>
            <view class="stat-item">
              <view class="stat-value">{{seasonStats.wins || 0}}</view>
              <view class="stat-label">{{i18n.stats_wins}}</view>
            </view>
            <view class="stat-item">
              <view class="stat-value">{{seasonStats.losses || 0}}</view>
              <view class="stat-label">{{i18n.stats_losses}}</view>
            </view>
            <view class="stat-item">
              <view class="stat-value">{{seasonWinRate}}</view>
              <view class="stat-label">{{i18n.stats_win_rate}}</view>
            </view>
          </view>

          <!-- Points Section -->
          <view class="stats-grid season-stats">
            <view class="stat-item highlight">
              <view class="stat-value large">{{seasonStats.points || 0}}</view>
              <view class="stat-label">{{i18n.stats_points}}</view>
            </view>
          </view>
          <view class="points-breakdown" wx:if="{{seasonStats.eventPoints > 0 || seasonStats.adjustmentPoints !== 0}}">
            <text class="breakdown-text">{{i18n.stats_from_events || 'From events'}}: {{seasonStats.eventPoints || 0}}</text>
            <text class="breakdown-text" wx:if="{{seasonStats.adjustmentPoints !== 0}}">{{i18n.stats_adjustments || 'Adjustments'}}: {{seasonStats.adjustmentPoints > 0 ? '+' : ''}}{{seasonStats.adjustmentPoints}}</text>
          </view>
        </block>
        <block wx:else>
          <view class="empty-message">{{i18n.matches_no_matches}}</view>
        </block>
      </view>

      <!-- Event Breakdown -->
      <block wx:if="{{eventBreakdown.length > 0}}">
        <view class="card">
          <view class="title">{{i18n.stats_event_breakdown || 'Points by Event'}}</view>
          <view class="event-list">
            <view
              wx:for="{{eventBreakdown}}"
              wx:key="eventId"
              class="event-item"
              data-event-id="{{item.eventId}}"
              bindtap="navigateToEvent"
            >
              <view class="event-info">
                <text class="event-title">{{item.eventTitle}}</text>
                <text class="event-date">{{item.eventDate}}</text>
              </view>
              <view class="event-points">{{item.placement === 1 ? 'ğŸ† ' : ''}}{{item.placement === 2 ? 'ğŸ¥ˆ ' : ''}}+{{item.points}}</view>
            </view>
          </view>
        </view>
      </block>
    </block>
  </block>
</view>
